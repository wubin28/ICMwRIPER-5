# TODO: Add bubble subcommand to icmwriper-5

Created: 2025-10-03--05-16

## DETAILED TECHNICAL SPECIFICATION

### File to Modify
- `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5`

### Changes Required

#### 1. Update Usage Message (Line 5)
**Current:**
```bash
echo "Usage: icmwriper-5 {generate <project-name> | story <story-name>}"
```

**New:**
```bash
echo "Usage: icmwriper-5 {generate <project-name> | story <story-name> | bubble <bubble-name>}"
```

#### 2. Add bubble subcommand handler (After line 73, before the else block)
Insert a new `elif` block between the `story` subcommand and the final `else`:

**Location:** After line 73 (after the `story` command's `exit 0`)

**Code to insert:**
```bash
elif [ "$1" = "bubble" ]; then
    # Bubble subcommand handler
    # Store bubble name
    BUBBLE_NAME="$2"

    # Check if source file exists
    if [ ! -f "$BUBBLE_NAME" ]; then
        echo "Error: File '$BUBBLE_NAME' does not exist."
        exit 1
    fi

    # Generate timestamp
    TIMESTAMP=$(date +"%Y-%m-%d--%H-%M")

    # Define target filename
    TARGET_FILE="icm-bubble-$TIMESTAMP.md"

    # Copy file
    if ! cp "$BUBBLE_NAME" "$TARGET_FILE"; then
        echo "Error: Failed to copy '$BUBBLE_NAME' to '$TARGET_FILE'."
        exit 1
    fi

    # Replace the story reference with the new bubble filename
    sed -i "s/@icm-story-[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}--[0-9]\{2\}-[0-9]\{2\}\.md/@$TARGET_FILE/g" "$TARGET_FILE"

    # Success message
    echo "Success: Copied '$BUBBLE_NAME' to '$TARGET_FILE' and updated story reference."
    exit 0
```

#### 3. Update error message (Line 75)
**Current:**
```bash
echo "Error: Unknown command '$1'. Supported commands: 'generate', 'story'."
```

**New:**
```bash
echo "Error: Unknown command '$1'. Supported commands: 'generate', 'story', 'bubble'."
```

### Implementation Logic

The `bubble` subcommand will:
1. Accept a `<bubble-name>` parameter
2. Validate that the source file exists
3. Generate a timestamp in format `YYYY-MM-DD--HH-MM`
4. Create target filename as `icm-bubble-<timestamp>.md`
5. Copy the source file to the target filename
6. Use `sed` with regex pattern `@icm-story-[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{2}-[0-9]{2}\.md` to find and replace the story reference
7. Replace it with `@<target-filename>` (e.g., `@icm-bubble-2025-10-03--04-06.md`)
8. Output success message

### Regex Pattern Explanation
- Pattern: `@icm-story-[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}--[0-9]\{2\}-[0-9]\{2\}\.md`
- This matches: `@icm-story-YYYY-MM-DD--HH-MM.md`
- Uses basic regex syntax (escaped braces for `sed`)
- Replaces with: `@$TARGET_FILE` where `TARGET_FILE` contains the new bubble filename

---

## IMPLEMENTATION CHECKLIST:

- [x] 1. Edit `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5` line 5 to update usage message to include `bubble` command
- [x] 2. Edit `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5` to add `bubble` subcommand handler between line 73 and line 74
- [x] 3. Edit `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5` line 75 to update error message to include `bubble` in supported commands list

---

## REVIEW SECTION

### Changes Made

All planned changes have been successfully implemented:

1. **Updated usage message (line 5)**: Changed from `{generate <project-name> | story <story-name>}` to `{generate <project-name> | story <story-name> | bubble <bubble-name>}`

2. **Added bubble subcommand handler (lines 75-103)**: Implemented complete bubble subcommand that:
   - Validates bubble file exists
   - Generates timestamp in format YYYY-MM-DD--HH-MM
   - Copies source file to `icm-bubble-<timestamp>.md`
   - Uses sed with regex pattern to replace `@icm-story-YYYY-MM-DD--HH-MM.md` references with `@icm-bubble-<timestamp>.md`
   - Outputs success message

3. **Updated error message (line 105)**: Changed from `Supported commands: 'generate', 'story'.` to `Supported commands: 'generate', 'story', 'bubble'.`

### Implementation Notes

- The sed command uses basic regex syntax with escaped braces: `[0-9]\{4\}` for matching 4 digits
- The `-i` flag performs in-place replacement in the target file
- The `g` flag ensures all matching patterns in the file are replaced
- Error handling follows the same pattern as the existing `story` subcommand
