# Implementation Plan: Add generate-nextjs-web-app Subcommand

**Created**: 2025-10-17 00:18

**Story**: icm-story-2025-10-17--00-03.md

**Bubble**: icm-bubble-2025-10-17--00-03.md (not yet created)

## Technical Specification

### Overview
Add a new `generate-nextjs-web-app` subcommand to `icmwriper-5-for-ubuntu` script following the exact pattern established by `generate-html-data-dashboard`.

### File to Modify
- **File path**: `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5-for-ubuntu`
- **Modification location**: Lines 138-140 (before the final `else` block)

### Detailed Changes

#### Change 1: Update usage message (Line 24)
**Current**:
```bash
echo "Usage: icmwriper-5-for-ubuntu {bubble-log | snb <story-name> | generate-html-data-dashboard <project-name>}"
```

**New**:
```bash
echo "Usage: icmwriper-5-for-ubuntu {bubble-log | snb <story-name> | generate-html-data-dashboard <project-name> | generate-nextjs-web-app <project-name>}"
```

#### Change 2: Update usage message (Line 31)
**Current**:
```bash
echo "Usage: icmwriper-5-for-ubuntu {bubble-log | snb <story-name> | generate-html-data-dashboard <project-name>}"
```

**New**:
```bash
echo "Usage: icmwriper-5-for-ubuntu {bubble-log | snb <story-name> | generate-html-data-dashboard <project-name> | generate-nextjs-web-app <project-name>}"
```

#### Change 3: Update error message (Line 139)
**Current**:
```bash
echo "Error: Unknown command '$1'. Supported commands: 'bubble-log', 'snb', 'generate-html-data-dashboard'."
```

**New**:
```bash
echo "Error: Unknown command '$1'. Supported commands: 'bubble-log', 'snb', 'generate-html-data-dashboard', 'generate-nextjs-web-app'."
```

#### Change 4: Add new `elif` block (Insert between line 137 and line 138)
**Insert the following code block**:

```bash

elif [ "$1" = "generate-nextjs-web-app" ]; then
    # Generate Next.js Web App subcommand handler
    # Store project name
    PROJECT_NAME="$2"

    # Directory existence check
    if [ -d "$PROJECT_NAME" ]; then
        echo "Error: Directory '$PROJECT_NAME' already exists."
        exit 1
    fi

    # GitHub repository configuration
    GITHUB_RAW_URL="https://raw.githubusercontent.com/wubin28/ICMwRIPER-5/main"

    # Define files to download with their paths
    # Root files (2 files)
    ROOT_FILES=("icmwriper-5.md" "README.md")

    # Subdirectory files (3 files)
    SUBDIR_FILES=("for-nextjs-web-app/icm-bubble-template-for-nextjs-web-app.md" "for-nextjs-web-app/icm-story-template-for-nextjs-web-app.md" "for-nextjs-web-app/.gitignore")

    # Create project directory
    if ! mkdir "$PROJECT_NAME"; then
        echo "Error: Failed to create directory '$PROJECT_NAME'."
        exit 1
    fi

    # Download root files
    for filename in "${ROOT_FILES[@]}"; do
        url="$GITHUB_RAW_URL/$filename"
        if ! curl -f -sS -o "$PROJECT_NAME/$filename" "$url"; then
            echo "Error: Failed to download $filename from GitHub. Please check your internet connection and repository availability."
            rm -rf "$PROJECT_NAME"
            exit 1
        fi
    done

    # Download subdirectory files
    for filepath in "${SUBDIR_FILES[@]}"; do
        # Extract just the filename for the target
        filename=$(basename "$filepath")
        url="$GITHUB_RAW_URL/$filepath"
        if ! curl -f -sS -o "$PROJECT_NAME/$filename" "$url"; then
            echo "Error: Failed to download $filepath from GitHub. Please check your internet connection and repository availability."
            rm -rf "$PROJECT_NAME"
            exit 1
        fi
    done

    # Rename README.md
    mv "$PROJECT_NAME/README.md" "$PROJECT_NAME/icmwriper-5-README.md"

    # Success message
    echo "Success: Project '$PROJECT_NAME' created with ICMwRIPER-5 template files and Next.js web app resources."
    exit 0
```

## IMPLEMENTATION CHECKLIST:

1. [ ] Update usage message on line 24 to include `generate-nextjs-web-app <project-name>`
2. [ ] Update usage message on line 31 to include `generate-nextjs-web-app <project-name>`
3. [ ] Update error message on line 139 to include `'generate-nextjs-web-app'` in supported commands list
4. [ ] Insert new `elif [ "$1" = "generate-nextjs-web-app" ]; then` block between line 137 and line 138
5. [ ] Verify the script syntax with `bash -n icmwriper-5-for-ubuntu`
6. [ ] Test the new command: Create a test project with `icmwriper-5-for-ubuntu generate-nextjs-web-app test-nextjs-project`
7. [ ] Verify all 5 files were created correctly in the test project directory
8. [ ] Test existing `bubble-log` command still works
9. [ ] Test existing `generate-html-data-dashboard` command still works
10. [ ] Clean up test directories created during testing

## Testing Plan

**Test Case 1: New command with valid project name**
- Command: `icmwriper-5-for-ubuntu generate-nextjs-web-app my-nextjs-app`
- Expected: Creates directory with 5 files (2 root + 3 from subdirectory)
- Verify files: `icmwriper-5.md`, `icmwriper-5-README.md`, `.gitignore`, `icm-bubble-template-for-nextjs-web-app.md`, `icm-story-template-for-nextjs-web-app.md`

**Test Case 2: New command with existing directory**
- Command: `icmwriper-5-for-ubuntu generate-nextjs-web-app my-nextjs-app` (run twice)
- Expected: Second run fails with error message about directory existing

**Test Case 3: Existing commands unchanged**
- Command: `icmwriper-5-for-ubuntu bubble-log`
- Expected: Creates timestamped bubble log file

**Test Case 4: Invalid command**
- Command: `icmwriper-5-for-ubuntu invalid-command arg`
- Expected: Error message listing all 4 supported commands

## Files Summary

**Modified**: 1 file
- `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5-for-ubuntu` (4 changes: 3 message updates + 1 new code block)

**Created**: 0 files

**Final script size estimate**: ~197 lines (current 141 lines + ~56 new lines)

---

## REVIEW SECTION

**Completed**: 2025-10-17 00:27

### Implementation Summary

All checklist items were completed successfully. The `generate-nextjs-web-app` subcommand has been added to the `icmwriper-5-for-ubuntu` script.

### Changes Made

1. ✅ **Line 24**: Updated usage message to include `generate-nextjs-web-app <project-name>`
2. ✅ **Line 31**: Updated usage message to include `generate-nextjs-web-app <project-name>`
3. ✅ **Line 139**: Updated error message to include `'generate-nextjs-web-app'` in supported commands
4. ✅ **Lines 139-193**: Added new `elif` block implementing the `generate-nextjs-web-app` subcommand (56 lines)

### Final Script Details

- **Original size**: 141 lines
- **Final size**: 197 lines (added 56 lines)
- **New subcommand location**: Lines 139-193
- **Pattern followed**: Exact duplicate of `generate-html-data-dashboard` pattern

### Testing Results

All tests passed successfully:

**✅ Test 1: New command functionality**
- Command: `./icmwriper-5-for-ubuntu generate-nextjs-web-app test-nextjs-project`
- Result: SUCCESS - Created project directory with all 5 files
- Files verified:
  - `icmwriper-5.md` ✓
  - `icmwriper-5-README.md` ✓ (correctly renamed from README.md)
  - `.gitignore` ✓
  - `icm-bubble-template-for-nextjs-web-app.md` ✓
  - `icm-story-template-for-nextjs-web-app.md` ✓

**✅ Test 2: Existing bubble-log command**
- Command: `./icmwriper-5-for-ubuntu bubble-log`
- Result: SUCCESS - Created `bubble-2025-10-17--00-26.md`
- No regression detected

**✅ Test 3: Existing generate-html-data-dashboard command**
- Command: `./icmwriper-5-for-ubuntu generate-html-data-dashboard test-html-dashboard`
- Result: SUCCESS - Created project with HTML dashboard files
- No regression detected

**✅ Test 4: Script syntax validation**
- Command: `bash -n icmwriper-5-for-ubuntu`
- Result: No syntax errors

### Key Implementation Details

**Downloads from GitHub**:
- 2 root files: `icmwriper-5.md`, `README.md`
- 3 subdirectory files from `for-nextjs-web-app/`:
  - `icm-bubble-template-for-nextjs-web-app.md`
  - `icm-story-template-for-nextjs-web-app.md`
  - `.gitignore`

**Error handling**:
- Directory existence check ✓
- Download failure cleanup ✓
- Proper error messages ✓

### Conclusion

The implementation is complete and fully functional. The new `generate-nextjs-web-app` subcommand:
- Works correctly as specified
- Follows the established code pattern
- Does not affect existing functionality
- Has proper error handling and validation
- Downloads all required files from GitHub successfully

**Status**: ✅ IMPLEMENTATION COMPLETE AND TESTED
