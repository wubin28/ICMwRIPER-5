# TODO: Add story subcommand to icmwriper-5

**Created**: 2025-10-02--10-26

## DETAILED TECHNICAL SPECIFICATION

### File to Modify
- **File path**: `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5`

### Modifications Required

#### 1. Update Usage Message (Line 5)
**Current:**
```bash
echo "Usage: icmwriper-5 generate <project-name>"
```

**New:**
```bash
echo "Usage: icmwriper-5 {generate <project-name> | story <story-name>}"
```

#### 2. Replace Subcommand Validation (Lines 9-13)
**Current:**
```bash
# Subcommand validation
if [ "$1" != "generate" ]; then
    echo "Error: Unknown command '$1'. Only 'generate' is supported."
    exit 1
fi
```

**New:**
```bash
# Subcommand routing
if [ "$1" = "generate" ]; then
    # Generate subcommand handler will go here
elif [ "$1" = "story" ]; then
    # Story subcommand handler will go here
else
    echo "Error: Unknown command '$1'. Supported commands: 'generate', 'story'."
    exit 1
fi
```

#### 3. Wrap Existing Generate Logic (Lines 15-48)
**Action**: Indent and place existing generate logic (lines 15-48) inside the first if block

**Structure:**
```bash
if [ "$1" = "generate" ]; then
    # Store project name
    PROJECT_NAME="$2"

    # [All existing generate logic from lines 15-48]

elif [ "$1" = "story" ]; then
```

#### 4. Implement Story Subcommand Logic
**Action**: Add new story handler in the elif block

**Logic to implement:**
```bash
elif [ "$1" = "story" ]; then
    # Store story name
    STORY_NAME="$2"

    # Check if source file exists
    if [ ! -f "$STORY_NAME" ]; then
        echo "Error: File '$STORY_NAME' does not exist."
        exit 1
    fi

    # Generate timestamp
    TIMESTAMP=$(date +"%Y-%m-%d--%H-%M")

    # Define target filename
    TARGET_FILE="icm-story-$TIMESTAMP.md"

    # Copy file
    if ! cp "$STORY_NAME" "$TARGET_FILE"; then
        echo "Error: Failed to copy '$STORY_NAME' to '$TARGET_FILE'."
        exit 1
    fi

    # Success message
    echo "Success: Copied '$STORY_NAME' to '$TARGET_FILE'."
    exit 0
```

### Key Implementation Details
- **Timestamp format**: `yyyy-mm-dd--hh-mm` using `date +"%Y-%m-%d--%H-%M"`
- **File existence check**: `[ ! -f "$STORY_NAME" ]`
- **Copy operation**: `cp "$STORY_NAME" "$TARGET_FILE"` with error checking
- **Output file**: Always appends `.md` extension: `icm-story-$TIMESTAMP.md`
- **Error handling**: All errors print message and exit with code 1
- **Success handling**: Print confirmation and exit with code 0

---

## IMPLEMENTATION CHECKLIST:

1. [x] Update usage message on line 5 to include both subcommands
2. [x] Replace subcommand validation (lines 9-13) with if-elif-else structure
3. [x] Move existing generate logic (lines 15-48) into the first if block for "generate" subcommand
4. [x] Add story subcommand handler in elif block with: story name variable assignment
5. [x] Add story subcommand handler: file existence validation with error handling
6. [x] Add story subcommand handler: timestamp generation using date command
7. [x] Add story subcommand handler: target filename definition
8. [x] Add story subcommand handler: copy operation with error handling
9. [x] Add story subcommand handler: success message output
10. [x] Update error message in else block to list both supported commands

---

## REVIEW SECTION

### Summary of Changes

Successfully implemented the `story` subcommand for the `icmwriper-5` command. All 10 planned tasks were completed exactly as specified in the plan.

### Modified File
- `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5` (77 lines total after modifications)

### Implementation Details

1. **Usage Message (Line 5)**: Updated to show both `generate` and `story` subcommands
2. **Subcommand Routing (Lines 9-19)**: Replaced single-command validation with if-elif-else structure
3. **Generate Logic (Lines 10-46)**: Moved all existing generate logic inside the first if block
4. **Story Subcommand (Lines 48-73)**: Implemented complete story handler with:
   - Story name variable assignment (line 51)
   - File existence validation with error handling (lines 54-57)
   - Timestamp generation using `date +"%Y-%m-%d--%H-%M"` (line 60)
   - Target filename definition as `icm-story-$TIMESTAMP.md` (line 63)
   - Copy operation with error handling (lines 66-69)
   - Success message output (lines 72-73)
5. **Error Handling (Lines 74-76)**: Updated to list both supported commands

### Verification

The implementation follows the plan with 100% fidelity:
- Timestamp format: `yyyy-mm-dd--hh-mm` ✓
- File existence validation with error exit ✓
- Copy operation with error handling ✓
- All error messages print and exit with code 1 ✓
- Success message prints and exits with code 0 ✓
- Output file uses `.md` extension ✓

### Notes

No deviations from the plan were required. All changes were straightforward and implemented as specified.
