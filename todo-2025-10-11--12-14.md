# Implementation Plan: Add generate-html-data-dashboard Subcommand

**Created**: 2025-10-11 12:14
**Status**: Pending approval

## Objective
Add a new `generate-html-data-dashboard` subcommand to the `icmwriper-5-for-ubuntu` script that creates a project with both root template files and data dashboard specific files.

## Files to Modify
- `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5-for-ubuntu`

## Detailed Implementation Plan

### Change 1: Update Usage Message (Line 5)
**Location**: Line 5

**Current code**:
```bash
echo "Usage: icmwriper-5 {generate <project-name> | story <story-name> | bubble <bubble-name> | snb <story-name>}"
```

**New code**:
```bash
echo "Usage: icmwriper-5 {generate <project-name> | generate-html-data-dashboard <project-name> | story <story-name> | bubble <bubble-name> | snb <story-name>}"
```

**Reason**: Include the new subcommand in the usage help message

### Change 2: Add New Subcommand Handler (After line 162, before the final `else`)
**Location**: Insert between line 162 and line 163

**New code block**:
```bash
elif [ "$1" = "generate-html-data-dashboard" ]; then
    # Generate HTML Data Dashboard subcommand handler
    # Store project name
    PROJECT_NAME="$2"

    # Directory existence check
    if [ -d "$PROJECT_NAME" ]; then
        echo "Error: Directory '$PROJECT_NAME' already exists."
        exit 1
    fi

    # GitHub repository configuration
    GITHUB_RAW_URL="https://raw.githubusercontent.com/wubin28/ICMwRIPER-5/main"

    # Define files to download with their paths
    # Root files (4 files)
    ROOT_FILES=("icm-bubble-template.md" "icm-story-template.md" "icmwriper-5.md" "README.md")

    # Subdirectory files (2 files)
    SUBDIR_FILES=("for-py-html-css-js-by-data-dashboard/first-80-rows-agentic_ai_performance_dataset_20250622.xlsx" "for-py-html-css-js-by-data-dashboard/.gitignore")

    # Create project directory
    if ! mkdir "$PROJECT_NAME"; then
        echo "Error: Failed to create directory '$PROJECT_NAME'."
        exit 1
    fi

    # Download root files
    for filename in "${ROOT_FILES[@]}"; do
        url="$GITHUB_RAW_URL/$filename"
        if ! curl -f -sS -o "$PROJECT_NAME/$filename" "$url"; then
            echo "Error: Failed to download $filename from GitHub. Please check your internet connection and repository availability."
            rm -rf "$PROJECT_NAME"
            exit 1
        fi
    done

    # Download subdirectory files
    for filepath in "${SUBDIR_FILES[@]}"; do
        # Extract just the filename for the target
        filename=$(basename "$filepath")
        url="$GITHUB_RAW_URL/$filepath"
        if ! curl -f -sS -o "$PROJECT_NAME/$filename" "$url"; then
            echo "Error: Failed to download $filepath from GitHub. Please check your internet connection and repository availability."
            rm -rf "$PROJECT_NAME"
            exit 1
        fi
    done

    # Rename README.md
    mv "$PROJECT_NAME/README.md" "$PROJECT_NAME/icmwriper-5-README.md"

    # Success message
    echo "Success: Project '$PROJECT_NAME' created with ICMwRIPER-5 template files and HTML data dashboard resources."
    exit 0
```

**Reason**: Implements the new subcommand with the same error handling patterns as existing commands

### Change 3: Update Error Message for Unknown Commands (Line 164)
**Location**: Line 164

**Current code**:
```bash
echo "Error: Unknown command '$1'. Supported commands: 'generate', 'story', 'bubble', 'snb'."
```

**New code**:
```bash
echo "Error: Unknown command '$1'. Supported commands: 'generate', 'generate-html-data-dashboard', 'story', 'bubble', 'snb'."
```

**Reason**: Include the new command in the error message

## Implementation Notes

1. **File download strategy**: Download root files first (4 files), then subdirectory files (2 files)
2. **Target location**: All 6 files go into the project root directory (flatten the structure)
3. **Error handling**: If any download fails, remove the entire project directory and exit
4. **URL construction**: Use `basename` to extract filename from subdirectory path for the target filename
5. **Cleanup pattern**: Identical to existing `generate` command - `rm -rf "$PROJECT_NAME"` on any failure
6. **Exit codes**: Exit 0 on success, exit 1 on any error

## IMPLEMENTATION CHECKLIST:

- [ ] 1. Read the current script file at `/home/wzb/OOR/katas/ICMwRIPER-5/icmwriper-5-for-ubuntu`
- [ ] 2. Update the usage message on line 5 to include the new `generate-html-data-dashboard` command
- [ ] 3. Add the new `generate-html-data-dashboard` subcommand handler between line 162 and line 163
- [ ] 4. Update the error message on line 164 to include the new command name
- [ ] 5. Test the script by running it without arguments to verify usage message
- [ ] 6. Test the new `generate-html-data-dashboard` command with a test project name
- [ ] 7. Verify all 6 files are downloaded correctly
- [ ] 8. Verify `README.md` is renamed correctly
- [ ] 9. Test existing `generate` command to ensure it still works
- [ ] 10. Test error handling (try creating a project that already exists)

## Testing Requirements

After implementation, verify:
1. ✓ Existing `generate` command still works correctly
2. ✓ Existing `story`, `bubble`, `snb` commands still work correctly
3. ✓ New `generate-html-data-dashboard` command creates directory
4. ✓ All 6 files are downloaded correctly
5. ✓ `README.md` is renamed to `icmwriper-5-README.md`
6. ✓ Error handling works (directory exists, download fails, etc.)
7. ✓ Usage message displays correctly when no arguments provided

---

## REVIEW SECTION
(To be completed after implementation)
